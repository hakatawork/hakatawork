<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunchguide Stockholm</title>
    <link rel="icon" href="data:,">
    <style>
        /* Din befintliga CSS här */
    </style>
</head>
<body>
    <!-- Din befintliga HTML här -->

    <script>
        class LunchGuideApp {
            constructor() {
                this.logger = {
                    info: (msg) => console.log('[INFO]', msg),
                    error: (msg, err) => console.error('[ERROR]', msg, err)
                };
                
                try {
                    this.validateDOM();
                    this.initElements();
                    this.bindEvents();
                    this.initValues();
                    this.logger.info('App initialized successfully');
                } catch (error) {
                    this.logger.error('Initialization failed', error);
                    this.showCriticalError(error.message);
                }
            }

            validateDOM() {
                const requiredElements = [
                    'area', 'radius', 'radius-value', 
                    'min-rating', 'min-rating-value',
                    'max-price', 'max-price-value',
                    'search-btn', 'random-btn',
                    'loading', 'results-content',
                    'error-message'
                ];

                const missingElements = requiredElements.filter(id => !document.getElementById(id));
                
                if (missingElements.length > 0) {
                    throw new Error(`Saknade element: ${missingElements.join(', ')}`);
                }
            }

            initElements() {
                this.elements = {
                    area: document.getElementById('area'),
                    radius: document.getElementById('radius'),
                    radiusValue: document.getElementById('radius-value'),
                    minRating: document.getElementById('min-rating'),
                    minRatingValue: document.getElementById('min-rating-value'),
                    maxPrice: document.getElementById('max-price'),
                    maxPriceValue: document.getElementById('max-price-value'),
                    searchBtn: document.getElementById('search-btn'),
                    randomBtn: document.getElementById('random-btn'),
                    loading: document.getElementById('loading'),
                    resultsContent: document.getElementById('results-content'),
                    errorMessage: document.getElementById('error-message')
                };
            }

            bindEvents() {
                this.elements.radius.addEventListener('input', () => this.updateRadiusValue());
                this.elements.minRating.addEventListener('input', () => this.updateMinRatingValue());
                this.elements.maxPrice.addEventListener('input', () => this.updateMaxPriceValue());
                this.elements.searchBtn.addEventListener('click', () => this.searchRestaurants(false));
                this.elements.randomBtn.addEventListener('click', () => this.searchRestaurants(true));
            }

            initValues() {
                this.updateMaxPriceValue();
            }

            updateRadiusValue() {
                this.elements.radiusValue.textContent = this.elements.radius.value;
            }

            updateMinRatingValue() {
                this.elements.minRatingValue.textContent = this.elements.minRating.value;
            }

            updateMaxPriceValue() {
                const prices = ['1 ($)', '2 ($$)', '3 ($$$)', '4 ($$$$)'];
                this.elements.maxPriceValue.textContent = 
                    `${this.elements.maxPrice.value} (${prices[this.elements.maxPrice.value - 1]})`;
            }

            showCriticalError(message) {
                const errorContainer = document.createElement('div');
                errorContainer.style.position = 'fixed';
                errorContainer.style.top = '0';
                errorContainer.style.left = '0';
                errorContainer.style.right = '0';
                errorContainer.style.padding = '20px';
                errorContainer.style.backgroundColor = '#e74c3c';
                errorContainer.style.color = 'white';
                errorContainer.style.zIndex = '1000';
                errorContainer.style.textAlign = 'center';
                errorContainer.textContent = message;
                document.body.prepend(errorContainer);
            }

            // Lägg till de saknade metoderna här:
            searchRestaurants(isRandom = false) {
                try {
                    this.logger.info(`Starting restaurant search (random: ${isRandom})`);
                    this.elements.loading.style.display = 'block';
                    this.elements.resultsContent.innerHTML = '';

                    // Simulera API-anrop (ersätt med riktig Google Maps API-implementering)
                    setTimeout(() => {
                        this.elements.loading.style.display = 'none';
                        this.displayRestaurants(this.getMockRestaurants(), isRandom);
                    }, 1500);
                } catch (error) {
                    this.elements.loading.style.display = 'none';
                    this.logger.error('Search failed', error);
                    this.showError('Ett fel uppstod vid sökning av restauranger');
                }
            }

            getMockRestaurants() {
                return [
                    {
                        name: 'Testrestaurang 1',
                        vicinity: 'Testgatan 1, Stockholm',
                        rating: 4.2,
                        price_level: 2,
                        opening_hours: { weekday_text: ['Måndag: 11-22', 'Tisdag: 11-22'] },
                        website: 'https://example.com',
                        place_id: 'test1'
                    },
                    {
                        name: 'Testrestaurang 2',
                        vicinity: 'Testgatan 2, Stockholm',
                        rating: 3.8,
                        price_level: 3,
                        opening_hours: { weekday_text: ['Måndag: 10-21', 'Tisdag: 10-21'] },
                        website: 'https://example.com',
                        place_id: 'test2'
                    }
                ];
            }

            displayRestaurants(restaurants, isRandom = false) {
                try {
                    if (restaurants.length === 0) {
                        this.elements.resultsContent.innerHTML = '<p>Inga restauranger hittades med de valda filtren.</p>';
                        return;
                    }

                    if (isRandom) {
                        const restaurant = restaurants[0];
                        this.elements.resultsContent.innerHTML = `
                            <h2>Dagens lunchval!</h2>
                            <div class="restaurant">
                                <h3>${restaurant.name}</h3>
                                <div class="restaurant-info">
                                    <div class="info-item">
                                        <span class="info-label">Adress:</span> ${restaurant.vicinity || 'Okänd adress'}
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Betyg:</span> ${restaurant.rating || 'Inget betyg'}/5
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Prisnivå:</span> ${this.getPriceLevelString(restaurant.price_level)}
                                    </div>
                                </div>
                                ${restaurant.opening_hours ? `
                                <div class="opening-hours">
                                    <h4>Öppettider:</h4>
                                    <ul>
                                        ${this.getOpeningHours(restaurant.opening_hours).map(time => `<li>${time}</li>`).join('')}
                                    </ul>
                                </div>
                                ` : ''}
                                <div class="actions">
                                    <a href="https://www.google.com/maps/place/?q=place_id:${restaurant.place_id}" target="_blank">Visa på karta</a>
                                    ${restaurant.website ? `<a href="${restaurant.website}" target="_blank">Besök hemsida</a>` : ''}
                                </div>
                            </div>
                        `;
                    } else {
                        this.elements.resultsContent.innerHTML = `
                            <h2>Hittade ${restaurants.length} restauranger:</h2>
                            ${restaurants.map(restaurant => `
                                <div class="restaurant">
                                    <h3>${restaurant.name}</h3>
                                    <div class="restaurant-info">
                                        <div class="info-item">
                                            <span class="info-label">Adress:</span> ${restaurant.vicinity || 'Okänd adress'}
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Betyg:</span> ${restaurant.rating || 'Inget betyg'}/5
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">Prisnivå:</span> ${this.getPriceLevelString(restaurant.price_level)}
                                        </div>
                                    </div>
                                    <div class="actions">
                                        <a href="https://www.google.com/maps/place/?q=place_id:${restaurant.place_id}" target="_blank">Visa på karta</a>
                                        ${restaurant.website ? `<a href="${restaurant.website}" target="_blank">Besök hemsida</a>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        `;
                    }
                } catch (error) {
                    this.logger.error('Failed to display restaurants', error);
                    this.showError('Ett fel uppstod vid visning av restauranger');
                }
            }

            getPriceLevelString(priceLevel) {
                if (!priceLevel) return 'Okänd prisnivå';
                return ['Billig ($)', 'Mellan ($$)', 'Dyr ($$$)', 'Lyx ($$$$)'][priceLevel - 1] || 'Okänd prisnivå';
            }

            getOpeningHours(openingHours) {
                if (!openingHours || !openingHours.weekday_text) {
                    return ['Okända öppettider'];
                }
                return openingHours.weekday_text;
            }

            showError(message) {
                this.elements.errorMessage.textContent = message;
                this.elements.errorMessage.style.display = 'block';
                setTimeout(() => {
                    this.elements.errorMessage.style.display = 'none';
                }, 5000);
            }
        }

        // Starta appen när allt är laddat
        document.addEventListener('DOMContentLoaded', () => {
            new LunchGuideApp();
        });
    </script>
</body>
</html>
