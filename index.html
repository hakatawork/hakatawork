<!DOCTYPE html>
<html lang="sv">
<head>
    <!-- All CSS förblir oförändrad -->
    <style>
        /* ... befintlig CSS ... */
    </style>
</head>
<body>
    <!-- All HTML förblir oförändrad fram till script-delen -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // [Tidigare kod för elementreferenser och grundläggande funktioner förblir oförändrad]

            // Förbättrad funktion för att hitta meny-URL
            async function findMenuUrl(restaurant) {
                // Om vi redan har en meny-URL, använd den
                if (restaurant.menuUrl) return restaurant.menuUrl;
                
                // Försök hitta lunchmeny på webbplatsen
                if (restaurant.website) {
                    const commonMenuPaths = [
                        '/lunch', '/meny', '/menu', 
                        '/lunchmeny', '/lunch-menu',
                        '/dagens', '/dagens-lunch'
                    ];
                    
                    // Skapa potentiella meny-URL:er
                    const possibleUrls = commonMenuPaths.map(path => {
                        // Hantera både med och utan avslutande snedstreck
                        const baseUrl = restaurant.website.endsWith('/') ? 
                            restaurant.website.slice(0, -1) : restaurant.website;
                        return baseUrl + path;
                    });
                    
                    // Lägg till original-webbplatsen som sista alternativ
                    possibleUrls.push(restaurant.website);
                    
                    // Här skulle vi kunna göra en faktisk kontroll av URL:erna,
                    // men för enkelhetens skull antar vi att första giltiga sökväg fungerar
                    return possibleUrls[0];
                }
                
                // Fallback till Google-sökning
                return `https://www.google.com/search?q=${encodeURIComponent(restaurant.name + ' lunchmeny Stockholm')}`;
            }

            // Uppdaterad displayRestaurants-funktion
            async function displayRestaurants(restaurants, isRandom) {
                if (!restaurants || restaurants.length === 0) {
                    elements['results-content'].innerHTML = '<p>Inga restauranger hittades.</p>';
                    return;
                }

                let html = isRandom ? '<h2>Dagens lunchval!</h2>' : '<h2>Hittade restauranger:</h2>';
                
                // Loop genom restauranger och hitta meny-URL:er
                for (const restaurant of restaurants) {
                    const imageHtml = restaurant.photoUrl ? 
                        `<img src="${restaurant.photoUrl}" alt="${restaurant.name}" class="restaurant-image">` : 
                        '<div class="no-image">Ingen bild</div>';

                    // Hämta meny-URL (async)
                    let menuButton = '';
                    if (restaurant.hasMenu) {
                        try {
                            const menuUrl = await findMenuUrl(restaurant);
                            menuButton = `
                                <button class="menu-btn" onclick="window.open('${menuUrl}', '_blank')">
                                    ${menuUrl.includes('lunch') ? 'Lunchmeny' : 'Meny'}
                                </button>
                            `;
                        } catch (e) {
                            console.warn('Kunde inte hämta meny-URL:', e);
                        }
                    }

                    // Skapa webbplatsknapp ENDAST om riktig webbplats finns
                    const websiteButton = restaurant.website ? `
                        <button onclick="window.open('${restaurant.website}', '_blank')">
                            Besök webbplats
                        </button>
                    ` : '';

                    html += `
                        <div class="restaurant">
                            <div class="restaurant-image-container">
                                ${imageHtml}
                            </div>
                            <div class="restaurant-info">
                                <h3>${restaurant.name}</h3>
                                <p><strong>Adress:</strong> ${restaurant.vicinity || 'Okänd adress'}</p>
                                ${restaurant.distance ? `<p><strong>Avstånd:</strong> ${restaurant.distance}</p>` : ''}
                                ${restaurant.rating ? `<p><strong>Betyg:</strong> ${restaurant.rating}/5</p>` : ''}
                                <div class="actions">
                                    ${restaurant.place_id ? `
                                        <a href="https://www.google.com/maps?q=place_id:${restaurant.place_id}" target="_blank">Visa på karta</a>
                                    ` : ''}
                                    ${websiteButton}
                                    ${menuButton}
                                </div>
                            </div>
                        </div>
                    `;
                }

                elements['results-content'].innerHTML = html;
            }

            // Uppdaterad mockdata med explicita meny-URL:er
            function getMockRestaurants() {
                return [
                    {
                        name: 'Restaurang Pelikan',
                        vicinity: 'Blekingegatan 40, Stockholm',
                        rating: 4.4,
                        price_level: 3,
                        place_id: 'mock1',
                        photoUrl: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=400&fit=crop',
                        website: 'https://pelikan.se',
                        menuUrl: 'https://pelikan.se/lunch',
                        hasMenu: true,
                        distance: '0.5 km'
                    },
                    {
                        name: 'Kajsas Fisk',
                        vicinity: 'Hötorgshallen, Stockholm',
                        rating: 4.2,
                        price_level: 2,
                        place_id: 'mock2',
                        photoUrl: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400&h=400&fit=crop',
                        website: 'https://kajsasfisk.se',
                        menuUrl: 'https://kajsasfisk.se/meny',
                        hasMenu: true,
                        distance: '0.8 km'
                    },
                    {
                        name: 'Lunchrestaurang Södra',
                        vicinity: 'Södermalm, Stockholm',
                        rating: 4.0,
                        price_level: 2,
                        place_id: 'mock3',
                        photoUrl: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400&h=400&fit=crop',
                        website: 'https://lunchsodra.example.com',
                        hasMenu: false, // Ingen meny
                        distance: '1.2 km'
                    }
                ];
            }

            // [Resten av koden förblir oförändrad]
        });
    </script>
</body>
</html>
