<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunchguide Stockholm</title>
    <link rel="icon" href="data:,"> <!-- Fix för favicon-fel -->
    <style>
        /* Behåll din befintliga CSS här */
    </style>
</head>
<body>
    <!-- Behåll din befintliga HTML-struktur här -->

    <!-- Flytta script-taggen hit till slutet av body -->
    <script>
        // Logger-klass för centraliserad loggning
        class Logger {
            constructor() {
                this.logLevels = {
                    DEBUG: 0,
                    INFO: 1,
                    WARN: 2,
                    ERROR: 3
                };
                this.currentLogLevel = this.logLevels.DEBUG;
            }

            log(level, message, data = null) {
                if (level >= this.currentLogLevel) {
                    const timestamp = new Date().toISOString();
                    const levelStr = Object.keys(this.logLevels).find(key => this.logLevels[key] === level);
                    
                    console.log(`[${timestamp}] [${levelStr}] ${message}`);
                    if (data) {
                        console.log(data);
                    }
                }
            }

            debug(message, data = null) {
                this.log(this.logLevels.DEBUG, message, data);
            }

            info(message, data = null) {
                this.log(this.logLevels.INFO, message, data);
            }

            warn(message, data = null) {
                this.log(this.logLevels.WARN, message, data);
            }

            error(message, data = null) {
                this.log(this.logLevels.ERROR, message, data);
            }
        }

        // App-klass med förbättrad felhantering
        class LunchGuideApp {
            constructor() {
                this.logger = new Logger();
                this.initialize();
            }

            initialize() {
                try {
                    this.initElements();
                    this.bindEvents();
                    this.initValues();
                    this.logger.info('App initialized successfully');
                } catch (error) {
                    this.logger.error('Initialization failed', error);
                    this.showCriticalError('Ett kritiskt fel uppstod vid initiering av applikationen');
                }
            }

            initElements() {
                this.areaSelect = document.getElementById('area');
                this.radiusSlider = document.getElementById('radius');
                this.radiusValue = document.getElementById('radius-value');
                this.minRatingSlider = document.getElementById('min-rating');
                this.minRatingValue = document.getElementById('min-rating-value');
                this.maxPriceSlider = document.getElementById('max-price');
                this.maxPriceValue = document.getElementById('max-price-value');
                this.searchBtn = document.getElementById('search-btn');
                this.randomBtn = document.getElementById('random-btn');
                this.loadingDiv = document.getElementById('loading');
                this.resultsContent = document.getElementById('results-content');
                this.errorMessage = document.getElementById('error-message');

                if (!this.areaSelect || !this.radiusSlider || !this.searchBtn) {
                    throw new Error('Kritiska DOM-element saknas');
                }

                this.logger.debug('DOM elements initialized');
            }

            bindEvents() {
                try {
                    this.radiusSlider.addEventListener('input', () => this.updateRadiusValue());
                    this.minRatingSlider.addEventListener('input', () => this.updateMinRatingValue());
                    this.maxPriceSlider.addEventListener('input', () => this.updateMaxPriceValue());
                    this.searchBtn.addEventListener('click', () => this.searchRestaurants(false));
                    this.randomBtn.addEventListener('click', () => this.searchRestaurants(true));
                    this.logger.debug('Event listeners bound');
                } catch (error) {
                    this.logger.error('Failed to bind event listeners', error);
                    throw new Error('Kunde inte binda händelsehanterare');
                }
            }

            initValues() {
                try {
                    this.updateMaxPriceValue();
                } catch (error) {
                    this.logger.error('Failed to initialize values', error);
                }
            }

            showCriticalError(message) {
                const errorContainer = document.createElement('div');
                errorContainer.style.position = 'fixed';
                errorContainer.style.top = '0';
                errorContainer.style.left = '0';
                errorContainer.style.right = '0';
                errorContainer.style.padding = '20px';
                errorContainer.style.backgroundColor = '#e74c3c';
                errorContainer.style.color = 'white';
                errorContainer.style.zIndex = '1000';
                errorContainer.style.textAlign = 'center';
                errorContainer.textContent = message;
                document.body.prepend(errorContainer);
            }

            // Resten av dina metoder här (updateRadiusValue, searchRestaurants etc.)
            // ... (behåll samma implementering som tidigare för dessa metoder)
        }

        // Vänta på att DOM är redo innan vi initierar appen
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new LunchGuideApp();
        });

        // Hantera Google Maps API-fel
        window.gm_authFailure = function() {
            const errorContainer = document.createElement('div');
            errorContainer.style.position = 'fixed';
            errorContainer.style.top = '0';
            errorContainer.style.left = '0';
            errorContainer.style.right = '0';
            errorContainer.style.padding = '20px';
            errorContainer.style.backgroundColor = '#e74c3c';
            errorContainer.style.color = 'white';
            errorContainer.style.zIndex = '1000';
            errorContainer.style.textAlign = 'center';
            errorContainer.textContent = 'Fel vid anslutning till Google Maps. Kontrollera din internetanslutning.';
            document.body.prepend(errorContainer);
        };
    </script>

    <!-- Google Maps API -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSj344Kz756OVuhwq4btDf_6ymMPTqYvY&libraries=places&callback=initApp"
        async defer
        onerror="window.gm_authFailure()">
    </script>
</body>
</html>
